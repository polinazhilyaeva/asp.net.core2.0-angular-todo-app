(function(){"use strict";angular.module("appTodoList",["elements","ngRoute","angularjs-datetime-picker","angularMoment"]).config(function(n,t){n.when("/",{controller:"todoListController",templateUrl:"/views/todoListView.html"});n.when("/edit/:todoId",{controller:"editTodoController",templateUrl:"/views/editTodoView.html"});n.when("/view/:todoId",{controller:"viewTodoController",templateUrl:"/views/viewTodoInfoView.html"});n.when("/new",{controller:"newTodoController",templateUrl:"/views/newTodoView.html"});n.otherwise({redirectTo:"/"});t.hashPrefix("")})})(),function(){"use strict";function n(){return{require:"ngModel",restrict:"A",link:function(n,t,i,r){r.$validators.invalidDate=function(n){return moment(n,["DD/MM/YYYY HH:mm"]).isValid()}}}}angular.module("appTodoList").directive("invalidDate",n)}(),function(){"use strict";function n(){return{scope:{show:"=displayWhen"},templateUrl:"/views/loadingSpinner.html"}}function t(){return{templateUrl:"/views/deleteConfirmModal.html",controller:"deleteTodoController"}}angular.module("elements",[]).directive("loadingSpinner",n);angular.module("elements").directive("deleteConfirmModal",t)}(),function(){"use strict";angular.module("appTodoList").factory("todoList",function(){var n={list:[],get:function(){return n.list},set:function(t){n.list=t},addTodo:function(t){n.list.push(t)},removeTodo:function(t){n.list.splice(t,1)},setTodoAtIndex:function(t,i){n.list[i]=t}};return n})}(),function(){"use strict";angular.module("appTodoList").factory("todoItem",function(n,t,i,r){function f(t,i,r,u){var e=n().utcOffset(),f;return f=n(t,i),f=u?f.subtract(e,"m"):f.add(e,"m"),f.format(r)}var u={properties:{id:null,name:null,priority:null,dueDateTime:null,comment:null},index:null,priorityOptions:[{value:"1",name:"Low"},{value:"2",name:"Normal"},{value:"3",name:"High"}],set:function(n,t){angular.copy(n,u.properties);u.index=t==="undefined"?null:t},reset:function(){u.properties={id:null,name:null,priority:null,dueDateTime:null,comment:null};u.index=null},getFromServer:function(n,i){return t.get("/api/todos/"+n).then(function(n){angular.copy(n.data,i.todo);i.priorityName=u.getPriorityName(i.todo.priority);i.todo.dueDateTime=u.getDateFormattedForClient(i.todo.dueDateTime)},function(){i.errorMessage="Failed to load data from the server. Check the link and try again"}).finally(function(){i.isBusy=!1}),i},updateOnServer:function(n,r,u){return t.put("/api/todos/"+n,u.todo).then(function(){u.isBusy=!1;u.list.setTodoAtIndex(u.todo,r);i.path("#/")},function(){u.errorMessage="Failed to update a task on the server"}).finally(function(){u.isBusy=!1}),u},getDateFormattedForClient:function(n){return f(n,"YYYY-MM-DD HH:mm:ss","DD/MM/YYYY HH:mm",!1)},getDateFormattedForClientShort:function(n){return f(n,"YYYY-MM-DD HH:mm:ss","DD/MM/YYYY",!1)},getDateFormattedForServer:function(n){return f(n,"DD/MM/YYYY HH:mm","YYYY-MM-DD HH:mm:ss",!0)},getDeadlineColor:function(t){var f=n().format(u.serverDatetimeFormat),e=n().utcOffset(),o=t.dueDateTime,i="red",r;return r=n(o,u.serverDatetimeFormat).add(e,"m"),r.isSameOrAfter(f)&&(i="green"),i},getStarsMarkup:function(n){for(var i="",t=1;t<=n;t++)i+='<i class="fa fa-star"><\/i>';return r.trustAsHtml(i)},getPriorityName:function(n){var t;return t=u.priorityOptions.find(function(t){return t.value==n.toString()}),t.name}};return u})}(),function(){"use strict";function n(n,t,i,r,u){n.todoList=r.get();n.todoList.length==0&&(n.isBusy=!0,n.errorMessage="",t.get("/api/todos").then(function(t){angular.copy(t.data,n.todoList);r.set(n.todoList)},function(){n.errorMessage="Failed to load todo list from the server"}).finally(function(){n.isBusy=!1}));n.getDeadlineColor=u.getDeadlineColor;n.getDeadline=u.getDateFormattedForClientShort;n.getStars=u.getStarsMarkup;n.viewTodo=function(n){u.set(n);i.path("/view/"+n.id)};n.editTodo=function(n,t){u.set(n,t);i.path("/edit/"+n.id)};n.completeTodo=function(n,t){u.set(n,t)}}angular.module("appTodoList").controller("todoListController",n)}(),function(){"use strict";function n(n,t,i,r,u){n.priorityOptions=u.priorityOptions;n.addTodo=function(){var f=n.newTodo.dueDateTime;n.newTodo.dueDateTime=u.getDateFormattedForServer(f);n.newTodo.priority=n.priority;n.errorMessage="";t.post("/api/todos",n.newTodo).then(function(n){r.addTodo(n.data);i.path("#/")},function(){n.errorMessage="Failed to save a task to the server"})}}angular.module("appTodoList").controller("newTodoController",n)}(),function(){"use strict";function n(n,t,i,r){var u=r.properties;n.todo={};n.errorMessage="";n.isBusy=!0;n.getStars=r.getStarsMarkup;u.id!==null?(angular.copy(u,n.todo),n.isBusy=!1,r.reset(),n.todo.dueDateTime=r.getDateFormattedForClient(n.todo.dueDateTime),n.priorityName=r.getPriorityName(n.todo.priority)):n=r.getFromServer(i.todoId,n)}angular.module("appTodoList").controller("viewTodoController",n)}(),function(){"use strict";function n(n,t,i,r,u,f){var e=f.properties,o=f.index;n.todo={};n.list=u;n.errorMessage="";n.isBusy=!0;e.id!==null?(angular.copy(e,n.todo),f.reset(),n.isBusy=!1,n.priorityOptions=f.priorityOptions,n.priority=n.todo.priority.toString(),n.todo.dueDateTime=f.getDateFormattedForClient(n.todo.dueDateTime)):n=f.getFromServer(i.todoId,n);n.updateTodo=function(){n.todo.dueDateTime=f.getDateFormattedForServer(n.todo.dueDateTime);n.todo.priority=n.priority;n.isBusy=!0;n=f.updateOnServer(i.todoId,o,n)}}angular.module("appTodoList").controller("editTodoController",n)}(),function(){"use strict";function n(n,t,i,r){var u=r.index,f=r.properties.id;n.deleteModalId="deleteTodoModal";r.reset();n.deleteTodo=function(){t.delete("/api/todos/"+f).then(function(){i.removeTodo(u)},function(){n.errorMessage="Failed to delete a task from the server"})}}angular.module("appTodoList").controller("deleteTodoController",n)}();